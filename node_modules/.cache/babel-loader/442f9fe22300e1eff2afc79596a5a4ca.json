{"ast":null,"code":"import { each } from '@antv/util';\nvar ELLIPSIS_CODE = '\\u2026';\nvar ELLIPSIS_CODE_LENGTH = 2; // 省略号的长度\n\nfunction strLen(str) {\n  var len = 0;\n\n  for (var i = 0; i < str.length; i++) {\n    len += charAtLength(str, i);\n  }\n\n  return len;\n}\n\nfunction charAtLength(str, i) {\n  if (str.charCodeAt(i) > 0 && str.charCodeAt(i) < 128) {\n    return 1;\n  } else {\n    return 2;\n  }\n}\n\nfunction getLabelLength(isVertical, label) {\n  var bbox = label.getCanvasBBox();\n  return isVertical ? bbox.width : bbox.height;\n}\n\nfunction ellipsisLabel(isVertical, label, limitLength, position) {\n  var text = label.attr('text');\n  var labelLength = getLabelLength(isVertical, label);\n  var codeLength = strLen(text);\n  var ellipsised = false;\n\n  if (limitLength < labelLength) {\n    var reseveLength = Math.floor(limitLength / labelLength * codeLength) - ELLIPSIS_CODE_LENGTH; // 计算出来的应该保存的长度\n\n    var newText = void 0;\n\n    if (reseveLength >= 0) {\n      newText = ellipsisString(text, reseveLength, position);\n    } else {\n      newText = ELLIPSIS_CODE;\n    }\n\n    if (newText) {\n      label.attr('text', newText);\n      ellipsised = true;\n    }\n  }\n\n  if (ellipsised) {\n    label.set('tip', text);\n  } else {\n    label.set('tip', null);\n  }\n\n  return ellipsised;\n}\n\nfunction ellipsisString(str, reseveLength, position) {\n  var count = str.length;\n  var rst = '';\n\n  if (position === 'tail') {\n    for (var i = 0, index = 0; i < reseveLength;) {\n      var charLength = charAtLength(str, index);\n\n      if (i + charLength <= reseveLength) {\n        rst += str[index];\n        i += charAtLength(str, index);\n        index++;\n      } else {\n        break;\n      }\n    }\n\n    rst += ELLIPSIS_CODE;\n  } else if (position === 'head') {\n    for (var i = 0, index = count - 1; i < reseveLength;) {\n      var charLength = charAtLength(str, index);\n\n      if (i + charLength <= reseveLength) {\n        rst += str[index];\n        i += charAtLength(str, index);\n        index--;\n      } else {\n        break;\n      }\n    }\n\n    rst = ELLIPSIS_CODE + rst;\n  } else {\n    var startStr = '';\n    var endStr = '';\n\n    for (var i = 0, startIndex = 0, endIndex = count - 1; i < reseveLength;) {\n      var startCodeLen = charAtLength(str, startIndex);\n      var hasAdd = false; // 设置标志位，防止头尾都没有附加字符\n\n      if (startCodeLen + i <= reseveLength) {\n        startStr += str[startIndex];\n        startIndex++;\n        i += startCodeLen;\n        hasAdd = true;\n      }\n\n      var endCodeLen = charAtLength(str, endIndex);\n\n      if (endCodeLen + i <= reseveLength) {\n        endStr = str[endIndex] + endStr;\n        i += endCodeLen;\n        endIndex--;\n        hasAdd = true;\n      }\n\n      if (!hasAdd) {\n        // 如果都没有增加字符，说明都不适合则中断\n        break;\n      }\n    }\n\n    rst = startStr + ELLIPSIS_CODE + endStr;\n  }\n\n  return rst;\n}\n\nfunction ellipseLabels(isVertical, labelGroup, limitLength, position) {\n  var children = labelGroup.getChildren();\n  var ellipsised = false;\n  each(children, function (label) {\n    var rst = ellipsisLabel(isVertical, label, limitLength, position);\n    ellipsised = ellipsised || rst;\n  });\n  return ellipsised;\n}\n\nexport function getDefault() {\n  return ellipsisTail;\n}\nexport function ellipsisHead(isVertical, labelGroup, limitLength) {\n  return ellipseLabels(isVertical, labelGroup, limitLength, 'head');\n}\nexport function ellipsisTail(isVertical, labelGroup, limitLength) {\n  return ellipseLabels(isVertical, labelGroup, limitLength, 'tail');\n}\nexport function ellipsisMiddle(isVertical, labelGroup, limitLength) {\n  return ellipseLabels(isVertical, labelGroup, limitLength, 'middle');\n}","map":{"version":3,"sources":["../../../src/axis/overlap/auto-ellipsis.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { each } from '@antv/util';\nvar ELLIPSIS_CODE = '\\u2026';\nvar ELLIPSIS_CODE_LENGTH = 2; // 省略号的长度\nfunction strLen(str) {\n    var len = 0;\n    for (var i = 0; i < str.length; i++) {\n        len += charAtLength(str, i);\n    }\n    return len;\n}\nfunction charAtLength(str, i) {\n    if (str.charCodeAt(i) > 0 && str.charCodeAt(i) < 128) {\n        return 1;\n    }\n    else {\n        return 2;\n    }\n}\nfunction getLabelLength(isVertical, label) {\n    var bbox = label.getCanvasBBox();\n    return isVertical ? bbox.width : bbox.height;\n}\nfunction ellipsisLabel(isVertical, label, limitLength, position) {\n    var text = label.attr('text');\n    var labelLength = getLabelLength(isVertical, label);\n    var codeLength = strLen(text);\n    var ellipsised = false;\n    if (limitLength < labelLength) {\n        var reseveLength = Math.floor((limitLength / labelLength) * codeLength) - ELLIPSIS_CODE_LENGTH; // 计算出来的应该保存的长度\n        var newText = void 0;\n        if (reseveLength >= 0) {\n            newText = ellipsisString(text, reseveLength, position);\n        }\n        else {\n            newText = ELLIPSIS_CODE;\n        }\n        if (newText) {\n            label.attr('text', newText);\n            ellipsised = true;\n        }\n    }\n    if (ellipsised) {\n        label.set('tip', text);\n    }\n    else {\n        label.set('tip', null);\n    }\n    return ellipsised;\n}\nfunction ellipsisString(str, reseveLength, position) {\n    var count = str.length;\n    var rst = '';\n    if (position === 'tail') {\n        for (var i = 0, index = 0; i < reseveLength;) {\n            var charLength = charAtLength(str, index);\n            if (i + charLength <= reseveLength) {\n                rst += str[index];\n                i += charAtLength(str, index);\n                index++;\n            }\n            else {\n                break;\n            }\n        }\n        rst += ELLIPSIS_CODE;\n    }\n    else if (position === 'head') {\n        for (var i = 0, index = count - 1; i < reseveLength;) {\n            var charLength = charAtLength(str, index);\n            if (i + charLength <= reseveLength) {\n                rst += str[index];\n                i += charAtLength(str, index);\n                index--;\n            }\n            else {\n                break;\n            }\n        }\n        rst = ELLIPSIS_CODE + rst;\n    }\n    else {\n        var startStr = '';\n        var endStr = '';\n        for (var i = 0, startIndex = 0, endIndex = count - 1; i < reseveLength;) {\n            var startCodeLen = charAtLength(str, startIndex);\n            var hasAdd = false; // 设置标志位，防止头尾都没有附加字符\n            if (startCodeLen + i <= reseveLength) {\n                startStr += str[startIndex];\n                startIndex++;\n                i += startCodeLen;\n                hasAdd = true;\n            }\n            var endCodeLen = charAtLength(str, endIndex);\n            if (endCodeLen + i <= reseveLength) {\n                endStr = str[endIndex] + endStr;\n                i += endCodeLen;\n                endIndex--;\n                hasAdd = true;\n            }\n            if (!hasAdd) {\n                // 如果都没有增加字符，说明都不适合则中断\n                break;\n            }\n        }\n        rst = startStr + ELLIPSIS_CODE + endStr;\n    }\n    return rst;\n}\nfunction ellipseLabels(isVertical, labelGroup, limitLength, position) {\n    var children = labelGroup.getChildren();\n    var ellipsised = false;\n    each(children, function (label) {\n        var rst = ellipsisLabel(isVertical, label, limitLength, position);\n        ellipsised = ellipsised || rst;\n    });\n    return ellipsised;\n}\nexport function getDefault() {\n    return ellipsisTail;\n}\nexport function ellipsisHead(isVertical, labelGroup, limitLength) {\n    return ellipseLabels(isVertical, labelGroup, limitLength, 'head');\n}\nexport function ellipsisTail(isVertical, labelGroup, limitLength) {\n    return ellipseLabels(isVertical, labelGroup, limitLength, 'tail');\n}\nexport function ellipsisMiddle(isVertical, labelGroup, limitLength) {\n    return ellipseLabels(isVertical, labelGroup, limitLength, 'middle');\n}\n//# sourceMappingURL=auto-ellipsis.js.map"]},"metadata":{},"sourceType":"module"}